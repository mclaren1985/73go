<!-- 1.19更改gsf -->
<style>
.a_buy{ padding:0 4px; border:1px solid #00469d; color: #00469d; height: 21px; line-height: 21px; display: inline-block;}
.a_buy:hover{background:#00469d;color:#fff; text-decoration:none;}
</style>
<script id="tmcInfo" type="text/html">
	
			<tr>
                <td width="100" height="30" align="center">企业名称</td>
                <td><*name*></td>
            </tr>
            <tr>
                <td height="30" align="center">业务内容<br/></td>
                <td>
                <div class="news_mod_form_cnt dt_time01 dt_time_xz">
				<*if bu_1==1 *>
					<a href="javascript:void(0)" class="current2">机票</a> 
 				<*else*>
					<a href="javascript:void(0)">机票</a> 
				<*/if*>
				<*if bu_2==1 *>
					<a href="javascript:void(0)" class="current2">酒店</a> 
 				<*else*>
					<a href="javascript:void(0)">酒店</a> 
				<*/if*>
				<*if bu_3==1 *>
					<a href="javascript:void(0)" class="current2">火车</a> 
 				<*else*>
					<a href="javascript:void(0)">火车</a> 
				<*/if*>
				<*if bu_4==1 *>
					<a href="javascript:void(0)" class="current2">租车</a> 
 				<*else*>
					<a href="javascript:void(0)">租车</a> 
				<*/if*>
				<*if bu_5==1 *>
					<a href="javascript:void(0)" class="current2">接送</a> 
 				<*else*>
					<a href="javascript:void(0)">接送</a> 
				<*/if*>
				<*if bu_6==1 *>
					<a href="javascript:void(0)" class="current2">签证</a> 
 				<*else*>
					<a href="javascript:void(0)">签证</a> 
				<*/if*>
				<*if bu_7==1 *>
					<a href="javascript:void(0)" class="current2">MICE</a> 
 				<*else*>
					<a href="javascript:void(0)">MICE</a> 
				<*/if*>
				<*if bu_99==1 *>
					<a href="javascript:void(0)" class="current2">其他</a> 
 				<*else*>
					<a href="javascript:void(0)">其他</a> 
				<*/if*>
				</div>
                <div class="clear"></div>
                </td>
            </tr>
            <tr>
                <td height="30" align="center">公司地址</td>
                <td><*address*></td>
            </tr>
            <tr>
                <td height="30" align="center">服务热线</td>
                <td><*hotline*></td>
            </tr>
            <tr>
                <td height="30" align="center">联系人</td>
                <td><*contact_name*></td>
            </tr>
            <tr>
                <td height="30" align="center">联系电话</td>
                <td><*contact_phone*></td>
            </tr>
            <tr>
                <td height="30" align="center">电子邮箱</td>
                <td><*email*></td>
            </tr>
            <tr>
                <td height="30" align="center">&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
</script>
<!-- 1.19更改gsf -->
    <div class="main_right">
    	<div class="r_hd">
            <h3 class="r_tit">差旅政策设置</h3>
           <div class="r_hd_extra">
				<a href="{:U('EP/indexjb')}" >基本差旅政策</a>
              <a href="{:U('EP/indexwj')}">差旅政策文件</a><a href="{:U('EP/indexts')}">特殊政策设置</a>
              <a href="{:U('EP/co_tmc_mgnt')}" class="current">协议商旅管理公司</a>
           
           
          </div>
    	</div>
        
        <div  class="BoxHeight mb_10" ></div>
      <div class="mt_10">
<!-- <span class="fl_right"><input type="button" id="addlink"  value="添加客户" class="btn_b5 ml_5" /></span> -->
<span class="fl_right"><input type="button"   onclick="tmc_pop(getComInfo,'{:U('home/pop/search_tmc_com')}',false,false)" value="添加商旅服务商" class="btn_b5 ml_5" /></span>
      </div><div  class="clear mb_10" ></div>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table_fund bg_tab">
          <tr>
            <th width="8%">序号</th>
            <th width="10%">企业编号</th>
            <th>企业名称</th>
            <th width="15%">结算类型</th>
            <th width="15%">协议时间</th>
            <th width="12%">协议状态</th>
            <th width="20%">审批状态</th>
          </tr>
          <volist name="co_link" id="link" key="k">
          		<if condition="$k%2 == 1">
          		<tr>
          		<else/> <tr class="tb_bg">
          		</if>
            <td>{$k}</td>
            <td><a href="javascript:void(0);" data-id="{$link.tmc_id}"  class="tex_blue xiaoGan">{$link.tmc_code}</a></td>
            <td>{$link.name}</td>
            <td><if condition="$link.pay_type == 1">
            	月结<else/>现付
            </if></td>
            <td>{$link.date|substr=0,10}</td>
			<td>
				<if condition="$link.status eq 0" >正常
				<elseif condition="$link.status eq 6" />本方未签
				<elseif condition="$link.status eq 7" />对方未签
				<elseif condition="$link.status eq 8" />未签署
				<elseif condition="$link.status eq 9" />终止
				</if>
			</td>
            <td>
				<if condition="$link.status eq 0" ><span class="a_buy" onclick="upd_status({$link.id},{$link.status})">中止协议</span>
				<elseif condition="$link.status eq 6" /><span class="a_buy" onclick="upd_status({$link.id},{$link.status})">签署协议</span><span class="a_buy ml_5" onclick="deleteLink(({$link.id}))">删除</span>
				<elseif condition="$link.status eq 7" /><span class="a_buy" onclick="upd_status({$link.id},{$link.status})">中止协议</span>
				<elseif condition="$link.status eq 8" /><span class="a_buy" onclick="upd_status({$link.id},{$link.status})">签署协议</span><span class="a_buy ml_5" onclick="deleteLink(({$link.id}))">删除</span>
				<elseif condition="$link.status eq 9" /><span class="a_buy" onclick="upd_status({$link.id},{$link.status})">签署协议</span><span class="a_buy ml_5" onclick="deleteLink(({$link.id}))">删除</span>
				</if>
			</td>
          </tr>
          </volist>
        </table>
        <br>
        <!-- 分页的样式 和数量的显现  开始-->
            <div class="meneame">
		    {$Page}
		    </div>
        	 <style>
			/*css meneame style pagination*/
			div.meneame{padding:3px;font-size:80%;margin:3px;color:#ff6500;text-align:center;}
			div.meneame a{border:#ff9600 1px solid;padding:5px 7px;background-position:50% bottom;background-image:url(../images/meneame.jpg);margin:0 3px 0 0;text-decoration:none;}
			div.meneame a:hover{border:#ff9600 1px solid;background-image:none;color:#ff6500;background-color:#ffc794;}
			div.meneame a:active{border:#ff9600 1px solid;background-image:none;color:#ff6500;background-color:#ffc794;}
			div.meneame span.current{border:#ff6500 1px solid;padding:5px 7px;font-weight:bold;color:#ff6500;margin:0 3px 0 0;background-color:#ffbe94;}
			div.meneame span.disabled{border:#ffe3c6 1px solid;padding:5px 7px;color:#ffe3c6;margin:0 3px 0 0;}
			</style>
        
    </div>
    <div class="clear"></div>
</div>


<!---popup 搜索弹出浮层 start --->

<div id="dd" class="popup popup_pos1" style="display: none;">
    <a href="javascript:void(0)" class="btn_close" id="btn_close" ></a>

    <div class="pop_title">TMC企业信息</div>
    <div class="popup_cont2">
        <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_p4" style="margin:0 auto;">
            <tbody id="tmcTemp"></tbody>
        </table>
    </div>
</div>

<!---popup 搜索弹出浮层 end --->


<!---popup 搜索弹出浮层 start ---><!--
<div id="dd"  class="popup popup_pos1" style="display: none;">
	       <a href="javascript:void(0)" class="btn_close" id="btn_close" ></a>
           <div class="pop_title">TMC企业搜索</div>
           <div class="popup_cont2">
             <input type="text" class="text01 c_tx2" value="" placeholder="TMC企业编号/TMC企业名称" id="code_name" />                          
             <input type="button" value="搜索" class="btn_b5 ml_5" onclick="inputfind()"/>
             <table width="100%" border="0" cellspacing="0" cellpadding="0" id="tb_link" class="table_fund bg_tab mt_10">
               <tr>
                 <th width="5%">&nbsp;</th>
                 <th width="25%">TMC企业编号</th>
                 <th>企业全称</th>
                 <th width="25%">企业简称</th>
               </tr>
               <foreach name="tmcnameadd" item="tn" >
               <tr id="tr_{$tn.id}">
                 <td><input type="checkbox" name="checkbox" id="checkbox_{$tn.id}" onclick="check({$tn.id})" value="" /></td>
                 <td>{$tn.tmc_code}</td>
                 <td id="name_{$tn.id}">{$tn.name}</td>
                 <td>{$tn.short_name}</td>
               </tr>
               </foreach>
             </table>
             <div class="news_mod_form_cnt dt_company01 dt_time_xz" id="a_content"> 
			</div><div class="clear"></div>
            <div class="text_cent"><a href="javascript:void(0)" id="getcheckid" class="btn_sure">确定</a></div>
                   
</div>
        </div>
        --> 
        <!---popup 搜索弹出浮层 end ---> 
<include file="Home@Public:tmc_pop" />
<script>
/* 1.19更改gsf */
$(function(){
	template.config('openTag','<*');
    template.config('closeTag','*>');
    /* 1.20更改gsf删除了eq(0) */
	$('.xiaoGan').click(function(){
		var id = $(this).data('id') || 0;
		//alert(id);
		$.ajax({
			url:"{:U('EP/ajax_tmc_basicinfo')}",
			data:"tmc_id="+id,
			type:"POST",
			typeData:'json',
			success:function(msg){
				if(msg){
				    var temp = template('tmcInfo', msg);
				    document.getElementById('tmcTemp').innerHTML=temp;
				}
			}
		});
		$('#dd').show();
		$("#btn_close").click(function(){
			$('#dd').css("display","none");
		});
	});
});
/* 1.19更改gsf */
function getComInfo(lst){
	var str = "";
	for(var i=0,len = lst.length;i<len;i++){
		str+=lst[i].tmc_id+',';
	}
	//alert(str);
	/* 1.19更改gsf */
	$.ajax({
	url:"{:U('EP/addLinkCustomer')}", 
	data:"str="+str,
	dataType:"text",
	type:"POST",
	success:function(msg){
		if(msg==1){
			alert("添加成功");
			window.location.reload();
		}
		else{
			msg=eval('('+msg+')');
			alert(msg+"已经添加");
			window.location.reload();
		}
	}
	});
	/* 1.19更改gsf */
}
</script>
<script>
//添加页面弹出框

//gsf更改1.19
	/*$('#addlink').click(function(){
		$('#dd').show();
	})
	$('#addlink').click(function(){
		$('#dd').show();
	})
	$("#btn_close").click(function(){
		$('#dd').css("display","none");
	});*/
	/*选中*/
	function check(id){
		var name = $('#name_'+id).text();
		$('#tr_'+id).hide();//隐藏tr
		$('#tr_'+id+' input:checked').removeAttr("checked");
		$("#a_content").append( '<a class="current" rel="'+id+'"  href="javascript:void(0)">'+name+'</a>');//容器包含
	};
	//删除客户使得恢复原来的tr进行显现
	$("#a_content a").click(function(){
		var id = $(this).attr("rel");	//获取当前id
		$(this).remove();//将点击这个东西进行消失的处理
		//将消失的数据进行恢复处理 
		$('#tr_'+id).show();
	});
	//获取复选框的值
    $("#getcheckid").click(function(){
    	var node =$('#a_content').children();
		//var name=$(":input[name=tr_user]").val();//获取已选人员
		var id='';
		for(var i = 0; i < node.length; i++) {
			id += node[i]['rel']+",";
		}
    	$.ajax({
    		url:"{:U('EP/addLinkCustomer')}", 
    		data:"str="+id,
    		dataType:"text",
    		type:"POST",
    		success:function(msg){
    			if(msg==1){
    				alert("添加成功");
    				window.location.reload();
    			}
    			else{
    				alert("添加失败");
    				window.location.reload();
    			}
    		}
    	});
        
    });

    //添加页面输入框查询
    function inputfind(){
    	var con=$('#code_name').val();
    	$.ajax({
			url:"{:U('EP/inputLink')}", 
			data:"con="+con,
			dataType:"text",
			type:"POST",
			success:function(data){
				var link = eval("(" + data + ")");
				var tb_link=$('#tb_link');
				$('#tb_link').eq(0).empty().append(tr2);   //清除内容
				var tr1=
					"<tr>"+
                		"<th width='5%'>"+"&nbsp;"+"</th>"+
                		"<th width='25%'>"+"TMC企业编号"+"</th>"+
               			"<th>"+"企业全称"+"</th>"+
                		"<th width='25%'>"+"企业简称"+"</th>"+
              		"</tr>"
                tb_link.append(tr1);
				for(var i=0;i<link.length;i++){
					var tr2=
						"<tr id='tr_"+link[i].id+"'>"+
						"<td>"+"<input type='checkbox' name='checkbox' id='checkbox_"+link[i].id+"' value='' />"+"</td>"+
		                "<td>"+link[i].tmc_code+"</td>"+
		                "<td id='name_"+link[i].id+"'>"+link[i].name+"</td>"+
		                "<td>"+link[i].short_name+"</td>"+
				        "</tr>"
				    tb_link.append(tr2);  
				}
			}
		});
    }
//协议状态修改
function upd_status(id,status){
		$.ajax({
			url:"{:U('EP/upd_link_status')}", 
			data:"id="+id+"&status="+status,
			dataType:"text",
			type:"POST",
			success:function(data){
				window.location.reload();
			}
		});
} 
//删除协议客户
function deleteLink(id){
	$.ajax({
		url:"{:U('EP/deleteLink')}", 
		data:"id="+id,
		dataType:"text",
		type:"POST",
		success:function(data){
			window.location.reload();
		}
	});
}  
</script>
