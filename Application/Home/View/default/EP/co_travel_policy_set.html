
    <div class="main_right">
   	  <div class="r_hd">
            <h3 class="r_tit">差旅政策设置</h3>
            <div class="r_hd_extra">
              <a href="{:U('EP/indexjb')}" class="current">基本差旅政策</a>
              <a href="{:U('EP/indexwj')}">差旅政策文件</a><a href="{:U('EP/indexts')}">特殊政策设置</a>
              <a href="{:U('EP/co_tmc_mgnt')}">协议商旅管理公司</a>
            </div>
    	</div>
   	  <div  class="BoxHeight mt38" ></div>

        <div class="btitle mt_22">
            <h4>出差流程</h4>
        </div>
        <form id="policyBox">
            <div class="policy">
                <input type="hidden" name="id" value="{$travel.id}"/>
                <input type="hidden" name="co_id" value="{$travel.co_id}"/>
                <p>
                    <label for="without_app" class="text-hover">
                        <input type="checkbox" name="without_app" id="without_app" <if condition="$travel.need_approval eq '0'">checked</if>/>
                        预定不需要审批
                    </label>
                </p>
                <if condition="$travel.need_approval eq '1'">
                    <label for="need_approval" class="text-hover">
                        <input type="checkbox" name="need_approval" id="need_approval" checked/>
                        预订前必须提交出差申请并审批通过
                    </label>
                    <!--<p class="ml_25">
                        <label for="approv_by73go" class="text-hover">
                            <if condition="$travel.approv_by73go eq '1'">
                                <input type="checkbox" name="approv_by73go" class="need_approval" id="approv_by73go" checked/>
                                <else/>
                                <input type="checkbox" name="approv_by73go" class="need_approval" id="approv_by73go"/>
                            </if>
                            使用本网站的出差申请和审批功能
                        </label>
                    </p>-->

                    <p class="ml_25">
                        <label for="emergency_booking" class="text-hover">
                            <if condition="$travel.emergency_booking eq '1'">
                                <input type="checkbox" name="emergency_booking" class="need_approval" id="emergency_booking" checked/>
                                <else/>
                                <input type="checkbox" name="emergency_booking" class="need_approval" id="emergency_booking"/>
                            </if>

                            允许紧急预订
                        </label>
                    </p>
                    <else/>
                    <label for="need_approval" class="text-hover">
                        <input type="checkbox" name="need_approval" id="need_approval"/>
                        预订前必须提交出差申请并审批通过
                    </label>
                    <!--<p class="ml_25">
                        <label for="approv_by73go" class="text-hover">
                            <input type="checkbox" name="approv_by73go" class="need_approval" id="approv_by73go" disabled/>
                            使用本网站的出差申请和审批功能
                        </label>
                    </p>-->

                    <p class="ml_25">
                        <label for="emergency_booking" class="text-hover">
                            <input type="checkbox" name="emergency_booking" class="need_approval" id="emergency_booking" disabled/>
                            允许紧急预订
                        </label>
                    </p>
                </if>

            </div>

            <div class="btitle mt_22"><h4>机票政策</h4></div>

            <div class="policy">
                <label for="f_class" class="text-hover">
                    <if condition="$travel.f_class eq '1'">
                        <input type="checkbox" name="f_class" id="f_class" checked/>
                        <else/>
                        <input type="checkbox" name="f_class" id="f_class"/>
                    </if>
                    允许乘坐头等舱
                </label>

            </div>
            <div class="policy">
                <label for="b_class" class="text-hover">

                    <if condition="$travel.b_class eq '1'">
                        <input type="checkbox" name="b_class" id="b_class" checked/>
                        <else/>
                        <input type="checkbox" name="b_class" id="b_class"/>
                    </if>

                    允许乘坐商务舱
                </label>
            </div>
            <div class="policy">
                <label for="e_class" class="text-hover">
                    <if condition="$travel.e_class eq '1'">
                        <input type="checkbox" name="e_class" id="e_class" checked/>
                        <else/>
                        <input type="checkbox" name="e_class" id="e_class"/>
                    </if>
                    允许乘坐经济舱
                </label>

            </div>

            <div class="btitle mt_22">
                <h4>火车票政策</h4>
            </div>
            <div class="policy">
                <label for="soft_sleeper">
                    <if condition="$travel.soft_sleeper eq '1'">
                        <input type="checkbox" name="soft_sleeper" id="soft_sleeper" checked/>
                        <else/>
                        <input type="checkbox" name="soft_sleeper" id="soft_sleeper"/>
                    </if>

                    允许火车软卧
                </label>
            </div>
            <div class="policy">
                <if condition="$travel.hard_sleeper eq '1'">
                    <label for="hard_sleeper">
                        <input type="checkbox" name="hard_sleeper" id="hard_sleeper" checked/>
                        允许火车硬卧
                    </label>

                    <p class="ml_25">
                        <label for="hard_sleeper_limit">
                            时间必须在<input name="hard_sleeper_limit" id="hard_sleeper_limit" value="{$travel.hard_sleeper_limit}" type="text" class="hard_sleeper text01 h20 c_tx2 w80"/>小时以上
                        </label>
                    </p>

                    <else/>
                    <label for="hard_sleeper">
                        <input type="checkbox" name="hard_sleeper" id="hard_sleeper"/>
                        允许火车硬卧
                    </label>

                    <p class="ml_25">
                        <label for="hard_sleeper_limit">
                            时间必须在<input name="hard_sleeper_limit" id="hard_sleeper_limit" type="text" class="hard_sleeper text01 h20 c_tx2 w80" disabled/>小时以上
                        </label>
                    </p>

                </if>

            </div>
            <div class="policy">
                <if condition="$travel.high_train eq '1'">
                    <label for="high_train">
                        <input type="checkbox" name="high_train" id="high_train" checked/>
                        允许趁坐高铁、动车
                    </label>

                    <p class="ml_25">
                        <label for="ht_b_class">
                            <if condition="$travel.ht_b_class eq '1'">
                                <input type="checkbox" class="high_train" name="ht_b_class" id="ht_b_class" checked/>
                                <else/>
                                <input type="checkbox" class="high_train" name="ht_b_class" id="ht_b_class"/>
                            </if>
                            允许商务座
                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="ht_class_1">
                            <if condition="$travel.ht_class_1 eq '1'">
                                <input type="checkbox" class="high_train" name="ht_class_1" id="ht_class_1" checked/>
                                <else/>
                                <input type="checkbox" class="high_train" name="ht_class_1" id="ht_class_1"/>
                            </if>
                            允许一等座
                        </label>
                    </p>

                    <p class="ml_25">
                        <label for="ht_class_2">
                            <if condition="$travel.ht_class_2 eq '1'">
                                <input type="checkbox" class="high_train" name="ht_class_2" id="ht_class_2" checked/>
                                <else/>
                                <input type="checkbox" class="high_train" name="ht_class_2" id="ht_class_2"/>
                            </if>
                            允许二等座
                        </label>

                    </p>
                    <else/>
                    <label for="high_train">
                        <input type="checkbox" name="high_train" id="high_train"/>
                        允许趁坐高铁、动车
                    </label>

                    <p class="ml_25">
                        <label for="ht_b_class">
                            <input type="checkbox" class="high_train" name="ht_b_class" id="ht_b_class" disabled/>
                            允许商务座
                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="ht_class_1">
                            <input type="checkbox" class="high_train" name="ht_class_1" id="ht_class_1" disabled/>
                            允许一等座
                        </label>
                    </p>

                    <p class="ml_25">
                        <label for="ht_class_2">
                            <input type="checkbox" class="high_train" name="ht_class_2" id="ht_class_2" disabled/>
                            允许二等座
                        </label>

                    </p>

                </if>


            </div>
            <div class="btitle mt_22">
                <h4>酒店政策</h4>
            </div>
            <div class="policy">
                <if condition="$travel.limit_hotel_price eq '1'">
                    <label for="limit_hotel_price">
                        <input type="checkbox" name="limit_hotel_price" id="limit_hotel_price" checked/>
                        按城市类别定义标准
                    </label>

                    <p class=" ml_25">
                        <label for="high_price_1">
                            一类城市<input name="high_price_1" id="high_price_1" value="{$travel.high_price_1}" type="text" class="text01 h20 c_tx2 w80 cityCost"/>元以下
                        </label>
                    </p>
                    <p class=" ml_25">
                        <label for="high_price_2">
                            二类城市<input name="high_price_2" id="high_price_2" value="{$travel.high_price_2}" type="text" class="text01 h20 c_tx2 w80 cityCost"/>元以下
                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="high_price_3">
                            三类城市<input name="high_price_3" id="high_price_3" value="{$travel.high_price_3}" type="text" class="text01 h20 c_tx2 w80 cityCost"/>元以下
                        </label>

                    </p>
                    <else/>
                    <label for="limit_hotel_price">
                        <input type="checkbox" name="limit_hotel_price" id="limit_hotel_price"/>
                        按城市类别定义标准
                    </label>

                    <p class=" ml_25">
                        <label for="high_price_1">
                            一类城市<input name="high_price_1" id="high_price_1" type="text" class="text01 h20 c_tx2 w80 cityCost" disabled/>元以下
                        </label>
                    </p>
                    <p class=" ml_25">
                        <label for="high_price_2">
                            二类城市<input name="high_price_2" id="high_price_2" type="text" class="text01 h20 c_tx2 w80 cityCost" disabled/>元以下
                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="high_price_3">
                            三类城市<input name="high_price_3" id="high_price_3" type="text" class="text01 h20 c_tx2 w80 cityCost" disabled/>元以下
                        </label>

                    </p>
                </if>

            </div>
            <div class="policy">
                <if condition="$travel.limit_hotel_class eq '1'">
                    <label for="limit_hotel_class">
                        <input type="checkbox" name="limit_hotel_class" id="limit_hotel_class" checked/>
                        按星级定义标准
                    </label>

                    <p class=" ml_25">
                        <label for="hotel_class_5">
                            <if condition="$travel.hotel_class_5 eq '1'">
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_5" id="hotel_class_5" checked/>五星
                                <else/>
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_5" id="hotel_class_5"/>五星
                            </if>
                        </label>
                    </p>

                    <p class=" ml_25">
                        <label for="hotel_class_4">
                            <if condition="$travel.hotel_class_4 eq '1'">
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_4" id="hotel_class_4" checked/>四星
                                <else/>
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_4" id="hotel_class_4"/>四星
                            </if>

                        </label>

                    </p>

                    <p class=" ml_25">

                        <label for="hotel_class_3">
                            <if condition="$travel.hotel_class_3 eq '1'">
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_3" id="hotel_class_3" checked/>三星
                                <else/>
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_3" id="hotel_class_3"/>三星
                            </if>

                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="hotel_class_2">
                            <if condition="$travel.hotel_class_2 eq '1'">
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_2" id="hotel_class_2" checked/>快捷酒店
                                <else/>
                                <input type="checkbox" class="limit_hotel_class" name="hotel_class_2" id="hotel_class_2"/>快捷酒店
                            </if>

                        </label>

                    </p>
                    <else/>
                    <label for="limit_hotel_class">
                        <input type="checkbox" name="limit_hotel_class" id="limit_hotel_class"/>
                        按星级定义标准
                    </label>

                    <p class=" ml_25">
                        <label for="hotel_class_5">
                            <input type="checkbox" class="limit_hotel_class" name="hotel_class_5" id="hotel_class_5" disabled/>五星
                        </label>
                    </p>

                    <p class=" ml_25">
                        <label for="hotel_class_4">
                            <input type="checkbox" class="limit_hotel_class" name="hotel_class_4" id="hotel_class_4" disabled/>四星

                        </label>

                    </p>

                    <p class=" ml_25">

                        <label for="hotel_class_3">
                            <input type="checkbox" class="limit_hotel_class" name="hotel_class_3" id="hotel_class_3" disabled/>三星
                        </label>

                    </p>

                    <p class=" ml_25">
                        <label for="hotel_class_2">
                            <input type="checkbox" class="limit_hotel_class" name="hotel_class_2" id="hotel_class_2" disabled/>快捷酒店
                        </label>

                    </p>

                </if>

            </div>
        </form>

    <div class="al_cent mt_22"><a href="javascript:void(0)" id="policyBtn" class="btn_sure">修改</a></div>
</div>
<div class="clear"></div>
</div>

<script type="text/javascript">

    $(function () {
        /**
         * 出差流程
         */
        $("input[name='need_approval']").click(function () {
            var res = this.checked;
            if(res){
                $('.need_approval').attr("disabled", false);
            }else{
                $('.need_approval').attr("disabled", true).attr("checked", false);
            }
        });

        /**
         * 火车票政策
         */
        $("input[name='hard_sleeper']").click(function () {
            var res = this.checked;
            if(res){
                $('.hard_sleeper').attr("disabled", false);
            }else{
                $('.hard_sleeper').attr("disabled", true).val("");
            }
        });


        $("input[name='high_train']").click(function () {
            var res = this.checked;
            if(res){
                $('.high_train').attr("disabled", false);
            }else{
                $('.high_train').attr("disabled", true).attr("checked", false);
            }
        });


        /**
         * 酒店政策
         */
        $("input[name='limit_hotel_price']").click(function () {
            var res = this.checked;
            if(res){
                $('.cityCost').attr("disabled", false);
            }else{
                $('.cityCost').attr("disabled", true).val("");
            }
        });


        $("input[name='limit_hotel_class']").click(function () {
            var res = this.checked;
            if(res){
                $('.limit_hotel_class').attr("disabled", false);
            }else{
                $('.limit_hotel_class').attr("disabled", true).attr("checked", false);
            }
        });
        /*限制只能是数字*/
        $('.cityCost').bind('blur', function () {
            var val = $(this).val() || '';
            var parten = /^\+?[1-9][0-9]{1,5}$/g;
            if(!parten.test(val)){
                $(this).val(1);
            }
        });
        /*限制时间两位*/
        $('.hard_sleeper').blur(function () {
            var val = $(this).val() || '';
            var parten = /^\+?[1-9]{1,2}$/g;
            if(!parten.test(val)){
                $(this).val(3);
            }
        });


        //修改企业差旅配置
        $('#policyBtn').click(function () {
            var obj = ZmJSON("policyBox");
            obj = eval("("+obj+")");
            $.ajax({
                url: "{:U('EP/updatebasicEP')}",
                data: obj,
                type: "POST",
                success: function (msg) {
                    msg = ajaxGet(msg);
                    if(msg){
                        swal({
                            title: "温馨提示!",
                            text: "修改成功!!!!",
                            type: "success",
                            confirmButtonText: "关 闭"
                        });
                    }else {
                        swal({
                            title: "温馨提示!",
                            text: "修改失败!!!",
                            type: "error",
                            confirmButtonText: "关 闭"
                        });
                    }
                }
            });
        });

    });

    /**
     * 控制预定不需要审批，预订前必须提交出差申请并审批通过不能同时选中
     * 创建者：王月
     * 创建时间：2015-3-24
     */
    $(function() {
        $('#without_app').click(function() {
            $('#need_approval').attr('checked',false);
            $('#emergency_booking').attr('checked',false);
        });
        $('#need_approval').click(function() {
            $('#without_app').attr('checked',false);
        });
    });

    /*json格式传递参数 zm*/
    function ZmJSON(formid){
        var fields = $("#"+formid).serialize();
        fields = decodeURIComponent(fields,true);//字符串转编码
        var dataResult =fields;
        var tmp = dataResult.replace(/&/g, "\",");
        tmp = tmp.replace(/=/g, ":\"");
        var jsonValue ="{" + tmp + "\\"}";
        return jsonValue;
    }
</script>


